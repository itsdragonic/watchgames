<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Watch Engine</title>
    <style>
        body {
            margin: 0;
            height: 780px; /* make width much bigger when working on computer (780px normally) */
            background-color: #fff;
            font-family: Arial, sans-serif;
            overflow: hidden; /* Prevent visual scrolling */
        }

        .rectangle {
            position: fixed;
            width: 20px;
            height: 60px;
            background: #000;
            border-radius: 20px;
            transform: translate(0, 0);
        }

        #player {
            top: 100px;
            left: calc(85% - 20px);
        }

        #ai {
            top: 100px;
            left: calc(15% - 20px);
        }

        .circle {
            position: fixed;
            width: 30px;
            height: 30px;
            background-color: red;
            border-radius: 50%;
            top: 55%;
            left: 45%;
            transform: translate(-50%, -50%);
        }

        .middle-value {
            position: fixed;
            color: red;
            font-size: 16px;
            top: 20%;
            left: 10px;
            white-space: pre-line;
        }

        .content {
            position: relative;
            top: 0;
            transition: transform 0.25s cubic-bezier(0.25, 0.8, 0.5, 1);
        }
    </style>
</head>
<body>
    <div class="content">
        <div id="player" class="rectangle"></div>
        <div id="ai" class="rectangle"></div>
        <div class="circle"></div>
        <div class="middle-value" id="middleValue"></div>
    </div>

    <script>
        const content = document.querySelector('.content');
        const middleValueDisplay = document.getElementById('middleValue');

        let tops = 100;
        let lastScrollY = 0;
        let lastTime = performance.now();
        let scrollSpeed = 0;
        let scrollTimeout;

        // Constants for compensation motion
        const SPEED_MULTIPLIER = 0.01; // Adjust the proportionality of movement speed
        const DISTANCE_MULTIPLIER = 0.002; // Adjust the proportionality of movement distance

        // Function to reset user to center
        function resetToCenter() {
            window.scrollTo({ top: document.body.scrollHeight / 2, left: 0, behavior: 'instant' });
        }

        // Function to calculate and apply compensation motion
        function compensateScroll() {
            const offset = scrollSpeed * DISTANCE_MULTIPLIER;
            content.style.transform = `translateY(${offset}px)`;

            // Return to normal position smoothly after 0.25s
            setTimeout(() => {
                content.style.transform = 'translateY(0)';
            }, 250);
        }

        // Function to handle scroll events
        function handleScroll() {
            const currentScroll = window.scrollY;
            const currentTime = performance.now();

            // Calculate scroll speed (derivative)
            const deltaY = currentScroll - lastScrollY;
            const deltaTime = currentTime - lastTime;
            scrollSpeed = deltaTime > 0 ? -(deltaY / (deltaTime / 1000)) : 0;

            // Trigger compensation motion
            compensateScroll();

            // Reset scroll speed to 0 after a delay
            clearTimeout(scrollTimeout);
            scrollTimeout = setTimeout(() => {
                scrollSpeed = 0;
            }, 100);

            // Update debug information
            middleValueDisplay.textContent = `Debug Top Position: ${tops}\nScroll Speed: ${scrollSpeed.toFixed(2)} px/s`;

            // Update last scroll values
            lastScrollY = currentScroll;
            lastTime = currentTime;
        }

        // Continuously keep the user at the center
        function continuousCentering() {
            resetToCenter();
            requestAnimationFrame(continuousCentering);
        }

        // Add scroll event listener
        window.onscroll = handleScroll;

        // Initialize centering and debug on page load
        window.onload = () => {
            resetToCenter();
            continuousCentering();
        };
    </script>
</body>
</html>
